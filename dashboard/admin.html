<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Healthcare Data Platform - Analytics Dashboard</title>
    <meta name="description" content="Centralized Patient Record System - Real-time Healthcare Analytics Dashboard">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
    <style>
        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #111827;
            --bg-card: rgba(17, 24, 39, 0.7);
            --bg-card-hover: rgba(30, 41, 59, 0.8);
            --border-color: rgba(99, 102, 241, 0.15);
            --border-glow: rgba(99, 102, 241, 0.3);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --accent-blue: #6366f1;
            --accent-cyan: #22d3ee;
            --accent-emerald: #10b981;
            --accent-rose: #f43f5e;
            --accent-amber: #f59e0b;
            --accent-violet: #8b5cf6;
            --gradient-1: linear-gradient(135deg, #6366f1, #8b5cf6);
            --gradient-2: linear-gradient(135deg, #22d3ee, #10b981);
            --gradient-3: linear-gradient(135deg, #f43f5e, #f59e0b);
            --gradient-4: linear-gradient(135deg, #8b5cf6, #ec4899);
            --shadow-card: 0 4px 24px rgba(0, 0, 0, 0.3);
            --shadow-glow: 0 0 30px rgba(99, 102, 241, 0.1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(ellipse at 15% 20%, rgba(99, 102, 241, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 85% 80%, rgba(34, 211, 238, 0.06) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(139, 92, 246, 0.04) 0%, transparent 60%);
            pointer-events: none;
            z-index: 0;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            height: 100vh;
            background: rgba(17, 24, 39, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border-color);
            padding: 24px 0;
            z-index: 100;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
        }

        .logo {
            padding: 0 24px 24px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 16px;
        }

        .logo h1 {
            font-size: 18px;
            font-weight: 700;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        .logo p {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 4px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .nav-section {
            padding: 8px 16px;
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 600;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 24px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 13.5px;
            font-weight: 500;
            border-left: 3px solid transparent;
        }

        .nav-item:hover,
        .nav-item.active {
            color: var(--text-primary);
            background: rgba(99, 102, 241, 0.08);
            border-left-color: var(--accent-blue);
        }

        .nav-item.active {
            background: rgba(99, 102, 241, 0.12);
        }

        .nav-icon {
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .sidebar-footer {
            margin-top: auto;
            padding: 16px 24px;
            border-top: 1px solid var(--border-color);
        }

        .sidebar-footer p {
            font-size: 11px;
            color: var(--text-muted);
        }

        /* Main content */
        .main {
            margin-left: 260px;
            padding: 24px 32px;
            position: relative;
            z-index: 1;
            min-height: 100vh;
        }

        /* Header */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 28px;
        }

        .header h2 {
            font-size: 24px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .header-subtitle {
            font-size: 13px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .header-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(16, 185, 129, 0.12);
            color: var(--accent-emerald);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .pulse-dot {
            width: 7px;
            height: 7px;
            background: var(--accent-emerald);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.5;
                transform: scale(1.3);
            }
        }

        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 28px;
        }

        .kpi-card {
            background: var(--bg-card);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-color);
            border-radius: 14px;
            padding: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
        }

        .kpi-card:nth-child(1)::before {
            background: var(--gradient-1);
        }

        .kpi-card:nth-child(2)::before {
            background: var(--gradient-2);
        }

        .kpi-card:nth-child(3)::before {
            background: var(--gradient-3);
        }

        .kpi-card:nth-child(4)::before {
            background: var(--gradient-4);
        }

        .kpi-card:nth-child(5)::before {
            background: linear-gradient(135deg, #f59e0b, #ef4444);
        }

        .kpi-card:nth-child(6)::before {
            background: linear-gradient(135deg, #14b8a6, #6366f1);
        }

        .kpi-card:hover {
            border-color: var(--border-glow);
            box-shadow: var(--shadow-glow);
            transform: translateY(-2px);
        }

        .kpi-label {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .kpi-value {
            font-size: 32px;
            font-weight: 800;
            letter-spacing: -1px;
            line-height: 1;
        }

        .kpi-card:nth-child(1) .kpi-value {
            color: var(--accent-blue);
        }

        .kpi-card:nth-child(2) .kpi-value {
            color: var(--accent-cyan);
        }

        .kpi-card:nth-child(3) .kpi-value {
            color: var(--accent-rose);
        }

        .kpi-card:nth-child(4) .kpi-value {
            color: var(--accent-violet);
        }

        .kpi-card:nth-child(5) .kpi-value {
            color: var(--accent-amber);
        }

        .kpi-card:nth-child(6) .kpi-value {
            color: var(--accent-emerald);
        }

        .kpi-sub {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 6px;
        }

        /* Section */
        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Chart grid */
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 28px;
        }

        .chart-grid-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .chart-card {
            background: var(--bg-card);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-color);
            border-radius: 14px;
            padding: 22px;
            transition: all 0.3s ease;
        }

        .chart-card:hover {
            border-color: var(--border-glow);
            box-shadow: var(--shadow-glow);
        }

        .chart-card.full-width {
            grid-column: 1 / -1;
        }

        .chart-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .chart-subtitle {
            font-size: 11px;
            color: var(--text-muted);
            margin-bottom: 16px;
        }

        .chart-container {
            position: relative;
            height: 280px;
        }

        .chart-container.tall {
            height: 360px;
        }

        /* Patient Table */
        .table-wrapper {
            background: var(--bg-card);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-color);
            border-radius: 14px;
            overflow: hidden;
        }

        .table-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 18px 22px;
            border-bottom: 1px solid var(--border-color);
        }

        .table-header h3 {
            font-size: 15px;
            font-weight: 600;
        }

        .search-box {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px 14px;
            color: var(--text-primary);
            font-size: 13px;
            width: 260px;
            font-family: 'Inter', sans-serif;
            outline: none;
            transition: border-color 0.2s;
        }

        .search-box:focus {
            border-color: var(--accent-blue);
        }

        .search-box::placeholder {
            color: var(--text-muted);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead th {
            background: rgba(30, 41, 59, 0.6);
            padding: 12px 16px;
            text-align: left;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid var(--border-color);
        }

        tbody td {
            padding: 12px 16px;
            font-size: 13px;
            color: var(--text-secondary);
            border-bottom: 1px solid rgba(99, 102, 241, 0.06);
        }

        tbody tr {
            transition: background 0.15s;
        }

        tbody tr:hover {
            background: rgba(99, 102, 241, 0.04);
        }

        .badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-m {
            background: rgba(99, 102, 241, 0.15);
            color: var(--accent-blue);
        }

        .badge-f {
            background: rgba(236, 72, 153, 0.15);
            color: #ec4899;
        }

        /* Doctor table */
        .doctor-rank {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            background: rgba(99, 102, 241, 0.1);
            color: var(--accent-blue);
        }

        .doctor-rank.gold {
            background: rgba(245, 158, 11, 0.15);
            color: var(--accent-amber);
        }

        .doctor-rank.silver {
            background: rgba(148, 163, 184, 0.15);
            color: #cbd5e1;
        }

        .doctor-rank.bronze {
            background: rgba(180, 120, 80, 0.15);
            color: #d4a26a;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(99, 102, 241, 0.3);
            border-radius: 3px;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }

            .chart-grid-3 {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .main {
                margin-left: 0;
                padding: 16px;
            }

            .kpi-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Loading animation */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            gap: 8px;
        }

        .loading-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--accent-blue);
            animation: loadBounce 1.4s ease-in-out infinite both;
        }

        .loading-dot:nth-child(1) {
            animation-delay: -0.32s;
        }

        .loading-dot:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes loadBounce {

            0%,
            80%,
            100% {
                transform: scale(0);
                opacity: 0.5;
            }

            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Counter animation */
        .count-up {
            display: inline-block;
        }
    </style>
</head>

<body>

    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="logo">
            <h1>HealthCare DP</h1>
            <p>Analytics Dashboard</p>
        </div>

        <div class="nav-section">Main</div>
        <div class="nav-item active" data-section="overview" onclick="switchSection('overview', this)">
            <span class="nav-icon">&#9673;</span> Overview
        </div>
        <div class="nav-item" data-section="patients" onclick="switchSection('patients', this)">
            <span class="nav-icon">&#9823;</span> Patients
        </div>
        <div class="nav-item" data-section="doctors" onclick="switchSection('doctors', this)">
            <span class="nav-icon">&#9877;</span> Doctors &amp; Hospitals
        </div>

        <div class="nav-section">Analytics</div>
        <div class="nav-item" data-section="visits" onclick="switchSection('visits', this)">
            <span class="nav-icon">&#8644;</span> Visits
        </div>
        <div class="nav-item" data-section="lab" onclick="switchSection('lab', this)">
            <span class="nav-icon">&#9878;</span> Lab Reports
        </div>
        <div class="nav-item" data-section="records" onclick="switchSection('records', this)">
            <span class="nav-icon">&#9776;</span> Patient Records
        </div>

        <div class="sidebar-footer">
            <p>CDAC Healthcare Platform</p>
            <p style="margin-top:4px; color: var(--accent-emerald);">Pipeline: Healthy</p>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main" id="mainContent">

        <!-- OVERVIEW SECTION -->
        <section class="section active" id="section-overview">
            <div class="header">
                <div>
                    <h2>Dashboard Overview</h2>
                    <p class="header-subtitle">Centralized Patient Record System</p>
                </div>
                <div class="header-badge">
                    <div class="pulse-dot"></div>
                    Live Data
                </div>
            </div>

            <div class="kpi-grid" id="kpiGrid">
                <!-- KPIs injected by JS -->
            </div>

            <div class="chart-grid">
                <div class="chart-card">
                    <div class="chart-title">Gender Distribution</div>
                    <div class="chart-subtitle">Male vs Female patients</div>
                    <div class="chart-container"><canvas id="genderChart"></canvas></div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Blood Group Distribution</div>
                    <div class="chart-subtitle">Patient count by blood type</div>
                    <div class="chart-container"><canvas id="bloodGroupChart"></canvas></div>
                </div>
                <div class="chart-card full-width">
                    <div class="chart-title">Monthly Visit Trends</div>
                    <div class="chart-subtitle">Visit volume over time</div>
                    <div class="chart-container tall"><canvas id="monthlyVisitChart"></canvas></div>
                </div>
            </div>
        </section>

        <!-- PATIENTS SECTION -->
        <section class="section" id="section-patients">
            <div class="header">
                <div>
                    <h2>Patient Analytics</h2>
                    <p class="header-subtitle">Demographics and distribution analysis</p>
                </div>
            </div>

            <div class="chart-grid">
                <div class="chart-card">
                    <div class="chart-title">Gender Split</div>
                    <div class="chart-subtitle">Overall patient gender ratio</div>
                    <div class="chart-container"><canvas id="genderChart2"></canvas></div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Blood Group Breakdown</div>
                    <div class="chart-subtitle">Detailed blood type distribution</div>
                    <div class="chart-container"><canvas id="bloodGroupChart2"></canvas></div>
                </div>
                <div class="chart-card full-width">
                    <div class="chart-title">Top 15 Cities by Patient Count</div>
                    <div class="chart-subtitle">Geographic distribution of registered patients</div>
                    <div class="chart-container tall"><canvas id="cityChart"></canvas></div>
                </div>
            </div>
        </section>

        <!-- DOCTORS SECTION -->
        <section class="section" id="section-doctors">
            <div class="header">
                <div>
                    <h2>Doctors &amp; Hospitals</h2>
                    <p class="header-subtitle">Provider network performance</p>
                </div>
            </div>

            <div class="chart-grid">
                <div class="chart-card">
                    <div class="chart-title">Doctor Specializations</div>
                    <div class="chart-subtitle">Distribution by medical field</div>
                    <div class="chart-container"><canvas id="specChart"></canvas></div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Hospital Network</div>
                    <div class="chart-subtitle">Doctors per hospital</div>
                    <div class="chart-container"><canvas id="hospitalDocChart"></canvas></div>
                </div>
                <div class="chart-card full-width">
                    <div class="chart-title">Hospital Performance Dashboard</div>
                    <div class="chart-subtitle">Total visits, unique patients, and active doctors per hospital</div>
                    <div class="chart-container tall"><canvas id="hospitalPerfChart"></canvas></div>
                </div>
            </div>

            <!-- Top Doctors Table -->
            <div class="table-wrapper" style="margin-top: 20px;">
                <div class="table-header">
                    <h3>Top 20 Doctors by Visits</h3>
                </div>
                <div style="overflow-x:auto; max-height:400px; overflow-y:auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Doctor</th>
                                <th>Specialization</th>
                                <th>Hospital</th>
                                <th>Total Visits</th>
                                <th>Unique Patients</th>
                            </tr>
                        </thead>
                        <tbody id="doctorTableBody"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- VISITS SECTION -->
        <section class="section" id="section-visits">
            <div class="header">
                <div>
                    <h2>Visit Analytics</h2>
                    <p class="header-subtitle">Patterns, reasons, and visit types</p>
                </div>
            </div>

            <div class="chart-grid">
                <div class="chart-card">
                    <div class="chart-title">Visit Types</div>
                    <div class="chart-subtitle">Consultation vs Diagnostic vs Emergency</div>
                    <div class="chart-container"><canvas id="visitTypeChart"></canvas></div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Visit Reasons</div>
                    <div class="chart-subtitle">Why patients seek care</div>
                    <div class="chart-container"><canvas id="visitReasonChart"></canvas></div>
                </div>
                <div class="chart-card full-width">
                    <div class="chart-title">Visit Reason - Unique Patients vs Total Visits</div>
                    <div class="chart-subtitle">How many unique patients visit for each reason</div>
                    <div class="chart-container tall"><canvas id="reasonDetailChart"></canvas></div>
                </div>
            </div>
        </section>

        <!-- LAB SECTION -->
        <section class="section" id="section-lab">
            <div class="header">
                <div>
                    <h2>Lab Reports</h2>
                    <p class="header-subtitle">Test results and diagnostics analysis</p>
                </div>
            </div>

            <div class="chart-grid">
                <div class="chart-card">
                    <div class="chart-title">Lab Test Types</div>
                    <div class="chart-subtitle">Volume by test category</div>
                    <div class="chart-container"><canvas id="labTestChart"></canvas></div>
                </div>
                <div class="chart-card">
                    <div class="chart-title">Result Outcomes</div>
                    <div class="chart-subtitle">Normal vs Abnormal distribution</div>
                    <div class="chart-container"><canvas id="labResultChart"></canvas></div>
                </div>
                <div class="chart-card full-width">
                    <div class="chart-title">Test Type vs Result Heatmap</div>
                    <div class="chart-subtitle">Detailed breakdown: how each test type distributes across result
                        categories</div>
                    <div class="chart-container tall"><canvas id="labHeatmapChart"></canvas></div>
                </div>
            </div>
        </section>

        <!-- RECORDS SECTION -->
        <section class="section" id="section-records">
            <div class="header">
                <div>
                    <h2>Patient Records</h2>
                    <p class="header-subtitle">Browse individual patient data</p>
                </div>
            </div>

            <div class="table-wrapper">
                <div class="table-header">
                    <h3>Registered Patients</h3>
                    <input type="text" class="search-box" id="patientSearch"
                        placeholder="Search by name, city, or ID..." oninput="filterPatients()">
                </div>
                <div style="overflow-x:auto; max-height:600px; overflow-y:auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>Patient ID</th>
                                <th>Name</th>
                                <th>Gender</th>
                                <th>DOB</th>
                                <th>Blood Group</th>
                                <th>City</th>
                            </tr>
                        </thead>
                        <tbody id="patientTableBody"></tbody>
                    </table>
                </div>
            </div>
        </section>

    </main>

    <script>
        // ========== GLOBALS ==========
        let dashboardData = null;
        const chartInstances = {};

        // Chart.js global config
        Chart.defaults.color = '#94a3b8';
        Chart.defaults.borderColor = 'rgba(99, 102, 241, 0.08)';
        Chart.defaults.font.family = "'Inter', sans-serif";
        Chart.defaults.font.size = 12;
        Chart.defaults.plugins.legend.labels.usePointStyle = true;
        Chart.defaults.plugins.legend.labels.padding = 16;

        // Color palettes
        const COLORS = {
            primary: ['#6366f1', '#8b5cf6', '#a78bfa', '#c4b5fd', '#818cf8', '#6366f1'],
            vibrant: ['#6366f1', '#22d3ee', '#10b981', '#f43f5e', '#f59e0b', '#8b5cf6', '#ec4899', '#14b8a6'],
            gradient_bg: [
                'rgba(99, 102, 241, 0.7)', 'rgba(34, 211, 238, 0.7)', 'rgba(16, 185, 129, 0.7)',
                'rgba(244, 63, 94, 0.7)', 'rgba(245, 158, 11, 0.7)', 'rgba(139, 92, 246, 0.7)',
                'rgba(236, 72, 153, 0.7)', 'rgba(20, 184, 166, 0.7)'
            ],
            gradient_border: [
                '#6366f1', '#22d3ee', '#10b981', '#f43f5e', '#f59e0b', '#8b5cf6', '#ec4899', '#14b8a6'
            ]
        };

        // ========== INIT ==========
        async function init() {
            try {
                const resp = await fetch('dashboard_data.json');
                dashboardData = await resp.json();
                renderKPIs();
                renderOverviewCharts();
                renderPatientCharts();
                renderDoctorCharts();
                renderVisitCharts();
                renderLabCharts();
                renderPatientTable();
                renderDoctorTable();
            } catch (e) {
                console.error('Failed to load data:', e);
                document.getElementById('mainContent').innerHTML =
                    '<div style="text-align:center;padding:100px;color:var(--text-muted);">' +
                    '<h2>Could not load dashboard data</h2>' +
                    '<p>Ensure dashboard_data.json exists. Run: python -m src.generate_dashboard_data</p></div>';
            }
        }

        // ========== NAVIGATION ==========
        function switchSection(name, el) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('section-' + name).classList.add('active');
            el.classList.add('active');
        }

        // ========== KPIs ==========
        function renderKPIs() {
            const o = dashboardData.overview;
            const kpis = [
                { label: 'Total Patients', value: o.total_patients, sub: `Across ${o.total_cities} cities` },
                { label: 'Total Doctors', value: o.total_doctors, sub: `In ${o.total_hospitals} hospitals` },
                { label: 'Total Visits', value: o.total_visits, sub: 'All visit types' },
                { label: 'Lab Reports', value: o.total_lab_reports, sub: 'Test results recorded' },
                { label: 'Cities Covered', value: o.total_cities, sub: 'Pan-India coverage' },
                { label: 'Hospitals', value: o.total_hospitals, sub: 'Network partners' },
            ];

            const grid = document.getElementById('kpiGrid');
            grid.innerHTML = kpis.map(k => `
            <div class="kpi-card">
                <div class="kpi-label">${k.label}</div>
                <div class="kpi-value"><span class="count-up" data-target="${k.value}">0</span></div>
                <div class="kpi-sub">${k.sub}</div>
            </div>
        `).join('');

            // Animate counters
            document.querySelectorAll('.count-up').forEach(el => {
                const target = parseInt(el.dataset.target);
                const duration = 1500;
                const start = performance.now();

                function update(now) {
                    const elapsed = now - start;
                    const progress = Math.min(elapsed / duration, 1);
                    const ease = 1 - Math.pow(1 - progress, 3);
                    el.textContent = Math.floor(target * ease).toLocaleString();
                    if (progress < 1) requestAnimationFrame(update);
                    else el.textContent = target.toLocaleString();
                }
                requestAnimationFrame(update);
            });
        }

        // ========== OVERVIEW CHARTS ==========
        function renderOverviewCharts() {
            const d = dashboardData;

            // Gender Doughnut
            createChart('genderChart', 'doughnut', {
                labels: Object.keys(d.gender_distribution).map(g => g === 'M' ? 'Male' : 'Female'),
                datasets: [{
                    data: Object.values(d.gender_distribution),
                    backgroundColor: ['rgba(99, 102, 241, 0.8)', 'rgba(236, 72, 153, 0.8)'],
                    borderColor: ['#6366f1', '#ec4899'],
                    borderWidth: 2,
                    hoverOffset: 8,
                }]
            }, { cutout: '65%' });

            // Blood Group
            createChart('bloodGroupChart', 'polarArea', {
                labels: Object.keys(d.blood_group_distribution),
                datasets: [{
                    data: Object.values(d.blood_group_distribution),
                    backgroundColor: COLORS.gradient_bg,
                    borderColor: COLORS.gradient_border,
                    borderWidth: 1,
                }]
            });

            // Monthly visits line chart
            const months = Object.keys(d.monthly_visits).sort();
            createChart('monthlyVisitChart', 'line', {
                labels: months,
                datasets: [{
                    label: 'Visits',
                    data: months.map(m => d.monthly_visits[m]),
                    borderColor: '#6366f1',
                    backgroundColor: createGradient('monthlyVisitChart', '#6366f1'),
                    fill: true,
                    tension: 0.4,
                    pointRadius: 4,
                    pointHoverRadius: 7,
                    pointBackgroundColor: '#6366f1',
                    pointBorderColor: '#1e1b4b',
                    pointBorderWidth: 2,
                }]
            }, {
                scales: {
                    y: { beginAtZero: true, grid: { color: 'rgba(99,102,241,0.06)' } },
                    x: { grid: { display: false } }
                }
            });
        }

        // ========== PATIENT CHARTS ==========
        function renderPatientCharts() {
            const d = dashboardData;

            createChart('genderChart2', 'doughnut', {
                labels: Object.keys(d.gender_distribution).map(g => g === 'M' ? 'Male' : 'Female'),
                datasets: [{
                    data: Object.values(d.gender_distribution),
                    backgroundColor: ['rgba(99, 102, 241, 0.8)', 'rgba(236, 72, 153, 0.8)'],
                    borderColor: ['#6366f1', '#ec4899'],
                    borderWidth: 2,
                    hoverOffset: 8,
                }]
            }, { cutout: '65%' });

            createChart('bloodGroupChart2', 'bar', {
                labels: Object.keys(d.blood_group_distribution),
                datasets: [{
                    label: 'Patients',
                    data: Object.values(d.blood_group_distribution),
                    backgroundColor: COLORS.gradient_bg,
                    borderColor: COLORS.gradient_border,
                    borderWidth: 1,
                    borderRadius: 6,
                }]
            }, {
                indexAxis: 'y',
                scales: {
                    x: { beginAtZero: true, grid: { color: 'rgba(99,102,241,0.06)' } },
                    y: { grid: { display: false } }
                }
            });

            // City distribution
            const cities = d.top_cities;
            createChart('cityChart', 'bar', {
                labels: cities.map(c => c.city),
                datasets: [{
                    label: 'Patients',
                    data: cities.map(c => c.patient_count),
                    backgroundColor: 'rgba(99, 102, 241, 0.6)',
                    borderColor: '#6366f1',
                    borderWidth: 1,
                    borderRadius: 6,
                }]
            }, {
                scales: {
                    y: { beginAtZero: true, grid: { color: 'rgba(99,102,241,0.06)' } },
                    x: { grid: { display: false } }
                }
            });
        }

        // ========== DOCTOR CHARTS ==========
        function renderDoctorCharts() {
            const d = dashboardData;

            createChart('specChart', 'doughnut', {
                labels: Object.keys(d.specialization_distribution),
                datasets: [{
                    data: Object.values(d.specialization_distribution),
                    backgroundColor: COLORS.gradient_bg,
                    borderColor: COLORS.gradient_border,
                    borderWidth: 2,
                    hoverOffset: 10,
                }]
            }, { cutout: '55%' });

            createChart('hospitalDocChart', 'bar', {
                labels: Object.keys(d.hospital_distribution),
                datasets: [{
                    label: 'Doctors',
                    data: Object.values(d.hospital_distribution),
                    backgroundColor: COLORS.gradient_bg.slice(0, Object.keys(d.hospital_distribution).length),
                    borderColor: COLORS.gradient_border.slice(0, Object.keys(d.hospital_distribution).length),
                    borderWidth: 1,
                    borderRadius: 8,
                }]
            }, {
                scales: {
                    y: { beginAtZero: true, grid: { color: 'rgba(99,102,241,0.06)' } },
                    x: { grid: { display: false } }
                }
            });

            // Hospital performance grouped bar
            const hosp = d.hospital_visits;
            createChart('hospitalPerfChart', 'bar', {
                labels: hosp.map(h => h.hospital),
                datasets: [
                    {
                        label: 'Total Visits',
                        data: hosp.map(h => h.total_visits),
                        backgroundColor: 'rgba(99, 102, 241, 0.7)',
                        borderColor: '#6366f1',
                        borderWidth: 1, borderRadius: 4,
                    },
                    {
                        label: 'Unique Patients',
                        data: hosp.map(h => h.unique_patients),
                        backgroundColor: 'rgba(34, 211, 238, 0.7)',
                        borderColor: '#22d3ee',
                        borderWidth: 1, borderRadius: 4,
                    },
                    {
                        label: 'Active Doctors',
                        data: hosp.map(h => h.active_doctors),
                        backgroundColor: 'rgba(16, 185, 129, 0.7)',
                        borderColor: '#10b981',
                        borderWidth: 1, borderRadius: 4,
                    }
                ]
            }, {
                scales: {
                    y: { beginAtZero: true, grid: { color: 'rgba(99,102,241,0.06)' } },
                    x: { grid: { display: false } }
                }
            });
        }

        // ========== VISIT CHARTS ==========
        function renderVisitCharts() {
            const d = dashboardData;

            createChart('visitTypeChart', 'doughnut', {
                labels: Object.keys(d.visit_type_distribution),
                datasets: [{
                    data: Object.values(d.visit_type_distribution),
                    backgroundColor: ['rgba(99,102,241,0.75)', 'rgba(34,211,238,0.75)', 'rgba(244,63,94,0.75)'],
                    borderColor: ['#6366f1', '#22d3ee', '#f43f5e'],
                    borderWidth: 2,
                    hoverOffset: 10,
                }]
            }, { cutout: '60%' });

            const reasons = d.visit_reason_analysis;
            createChart('visitReasonChart', 'bar', {
                labels: reasons.map(r => r.reason),
                datasets: [{
                    label: 'Total Visits',
                    data: reasons.map(r => r.total_visits),
                    backgroundColor: COLORS.gradient_bg.slice(0, reasons.length),
                    borderColor: COLORS.gradient_border.slice(0, reasons.length),
                    borderWidth: 1, borderRadius: 6,
                }]
            }, {
                indexAxis: 'y',
                scales: {
                    x: { beginAtZero: true, grid: { color: 'rgba(99,102,241,0.06)' } },
                    y: { grid: { display: false } }
                }
            });

            createChart('reasonDetailChart', 'bar', {
                labels: reasons.map(r => r.reason),
                datasets: [
                    {
                        label: 'Total Visits',
                        data: reasons.map(r => r.total_visits),
                        backgroundColor: 'rgba(99, 102, 241, 0.7)',
                        borderColor: '#6366f1',
                        borderWidth: 1, borderRadius: 4,
                    },
                    {
                        label: 'Unique Patients',
                        data: reasons.map(r => r.unique_patients),
                        backgroundColor: 'rgba(34, 211, 238, 0.7)',
                        borderColor: '#22d3ee',
                        borderWidth: 1, borderRadius: 4,
                    }
                ]
            }, {
                scales: {
                    y: { beginAtZero: true, grid: { color: 'rgba(99,102,241,0.06)' } },
                    x: { grid: { display: false } }
                }
            });
        }

        // ========== LAB CHARTS ==========
        function renderLabCharts() {
            const d = dashboardData;

            createChart('labTestChart', 'doughnut', {
                labels: Object.keys(d.lab_test_types),
                datasets: [{
                    data: Object.values(d.lab_test_types),
                    backgroundColor: COLORS.gradient_bg,
                    borderColor: COLORS.gradient_border,
                    borderWidth: 2,
                    hoverOffset: 10,
                }]
            }, { cutout: '55%' });

            createChart('labResultChart', 'polarArea', {
                labels: Object.keys(d.lab_results_overview),
                datasets: [{
                    data: Object.values(d.lab_results_overview),
                    backgroundColor: COLORS.gradient_bg.slice(0, Object.keys(d.lab_results_overview).length),
                    borderColor: COLORS.gradient_border.slice(0, Object.keys(d.lab_results_overview).length),
                    borderWidth: 1,
                }]
            });

            // Lab heatmap as grouped bar
            const labData = d.lab_result_distribution;
            const testTypes = [...new Set(labData.map(l => l.test_type))];
            const results = [...new Set(labData.map(l => l.result))];

            const datasets = results.map((res, i) => ({
                label: res,
                data: testTypes.map(tt => {
                    const match = labData.find(l => l.test_type === tt && l.result === res);
                    return match ? match.report_count : 0;
                }),
                backgroundColor: COLORS.gradient_bg[i % COLORS.gradient_bg.length],
                borderColor: COLORS.gradient_border[i % COLORS.gradient_border.length],
                borderWidth: 1, borderRadius: 4,
            }));

            createChart('labHeatmapChart', 'bar', {
                labels: testTypes,
                datasets: datasets
            }, {
                scales: {
                    y: { beginAtZero: true, stacked: false, grid: { color: 'rgba(99,102,241,0.06)' } },
                    x: { grid: { display: false } }
                }
            });
        }

        // ========== TABLES ==========
        function renderPatientTable() {
            const patients = dashboardData.recent_patients;
            const tbody = document.getElementById('patientTableBody');
            tbody.innerHTML = patients.map(p => `
            <tr>
                <td style="font-weight:600;color:var(--accent-blue);">${p.patient_id}</td>
                <td>${p.name}</td>
                <td><span class="badge ${p.gender === 'M' ? 'badge-m' : 'badge-f'}">${p.gender === 'M' ? 'Male' : 'Female'}</span></td>
                <td>${p.dob || '-'}</td>
                <td>${p.blood_group}</td>
                <td>${p.city}</td>
            </tr>
        `).join('');
        }

        function renderDoctorTable() {
            const docs = dashboardData.doctor_summary;
            const tbody = document.getElementById('doctorTableBody');
            tbody.innerHTML = docs.map((d, i) => {
                let rankClass = '';
                if (i === 0) rankClass = 'gold';
                else if (i === 1) rankClass = 'silver';
                else if (i === 2) rankClass = 'bronze';
                return `
                <tr>
                    <td><span class="doctor-rank ${rankClass}">${i + 1}</span></td>
                    <td style="font-weight:500;">${d.name}</td>
                    <td>${d.specialization}</td>
                    <td>${d.hospital}</td>
                    <td style="font-weight:600;color:var(--accent-blue);">${d.total_visits}</td>
                    <td>${d.unique_patients}</td>
                </tr>
            `;
            }).join('');
        }

        function filterPatients() {
            const query = document.getElementById('patientSearch').value.toLowerCase();
            const patients = dashboardData.recent_patients.filter(p =>
                p.name.toLowerCase().includes(query) ||
                p.city.toLowerCase().includes(query) ||
                p.patient_id.toLowerCase().includes(query)
            );
            const tbody = document.getElementById('patientTableBody');
            tbody.innerHTML = patients.map(p => `
            <tr>
                <td style="font-weight:600;color:var(--accent-blue);">${p.patient_id}</td>
                <td>${p.name}</td>
                <td><span class="badge ${p.gender === 'M' ? 'badge-m' : 'badge-f'}">${p.gender === 'M' ? 'Male' : 'Female'}</span></td>
                <td>${p.dob || '-'}</td>
                <td>${p.blood_group}</td>
                <td>${p.city}</td>
            </tr>
        `).join('');
        }

        // ========== CHART HELPER ==========
        function createChart(id, type, data, extraOpts = {}) {
            const ctx = document.getElementById(id);
            if (!ctx) return;

            if (chartInstances[id]) {
                chartInstances[id].destroy();
            }

            const options = {
                responsive: true,
                maintainAspectRatio: false,
                animation: { duration: 800, easing: 'easeOutQuart' },
                plugins: {
                    legend: {
                        position: type === 'doughnut' || type === 'polarArea' ? 'right' : 'top',
                        labels: { padding: 14, font: { size: 11 } }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(17, 24, 39, 0.95)',
                        titleColor: '#f1f5f9',
                        bodyColor: '#94a3b8',
                        borderColor: 'rgba(99, 102, 241, 0.3)',
                        borderWidth: 1,
                        cornerRadius: 8,
                        padding: 12,
                    }
                },
                ...extraOpts,
            };

            chartInstances[id] = new Chart(ctx.getContext('2d'), { type, data, options });
            return chartInstances[id];
        }

        function createGradient(chartId, color) {
            const ctx = document.getElementById(chartId);
            if (!ctx) return color;
            const gradient = ctx.getContext('2d').createLinearGradient(0, 0, 0, 360);
            gradient.addColorStop(0, color.replace(')', ', 0.3)').replace('rgb', 'rgba'));
            gradient.addColorStop(1, color.replace(')', ', 0.01)').replace('rgb', 'rgba'));
            return gradient;
        }

        // ========== LAUNCH ==========
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>