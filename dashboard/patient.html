<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Portal - Healthcare Data Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
    <style>
        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        :root {
            --bg: #0a0e1a;
            --bg2: #111827;
            --card: rgba(17, 24, 39, 0.7);
            --border: rgba(244, 63, 94, .15);
            --glow: rgba(244, 63, 94, .3);
            --text: #f1f5f9;
            --sub: #94a3b8;
            --muted: #64748b;
            --rose: #f43f5e;
            --blue: #6366f1;
            --cyan: #22d3ee;
            --emerald: #10b981;
            --amber: #f59e0b;
            --violet: #8b5cf6
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: radial-gradient(ellipse at 20% 20%, rgba(244, 63, 94, .06) 0%, transparent 50%), radial-gradient(ellipse at 80% 80%, rgba(139, 92, 246, .06) 0%, transparent 50%);
            pointer-events: none
        }

        /* Top bar */
        .topbar {
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 32px;
            background: rgba(17, 24, 39, .92);
            backdrop-filter: blur(16px);
            border-bottom: 1px solid var(--border)
        }

        .topbar-left {
            display: flex;
            align-items: center;
            gap: 14px
        }

        .topbar-left a {
            color: var(--muted);
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
            transition: color .2s
        }

        .topbar-left a:hover {
            color: var(--text)
        }

        .topbar h2 {
            font-size: 16px;
            font-weight: 700;
            background: linear-gradient(135deg, #f43f5e, #f59e0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text
        }

        .topbar-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(244, 63, 94, .1);
            color: var(--rose);
            padding: 5px 14px;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 600;
            border: 1px solid rgba(244, 63, 94, .2)
        }

        /* Login screen */
        .login-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 56px);
            padding: 40px;
            text-align: center
        }

        .login-screen h2 {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 8px;
            letter-spacing: -.5px
        }

        .login-screen p {
            color: var(--muted);
            font-size: 14px;
            margin-bottom: 32px
        }

        .login-box {
            background: var(--card);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 32px;
            width: 100%;
            max-width: 420px
        }

        .login-box label {
            display: block;
            text-align: left;
            font-size: 12px;
            color: var(--muted);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px
        }

        .login-input {
            width: 100%;
            padding: 12px 16px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: rgba(30, 41, 59, .6);
            color: var(--text);
            font-size: 15px;
            font-family: 'Inter', sans-serif;
            outline: none;
            transition: border-color .2s
        }

        .login-input:focus {
            border-color: var(--rose)
        }

        .login-input::placeholder {
            color: var(--muted)
        }

        .login-btn {
            width: 100%;
            padding: 13px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #f43f5e, #f59e0b);
            color: #fff;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 16px;
            font-family: 'Inter', sans-serif;
            transition: transform .2s, box-shadow .2s;
            letter-spacing: .3px
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(244, 63, 94, .3)
        }

        .login-error {
            color: var(--rose);
            font-size: 12px;
            margin-top: 12px;
            display: none
        }

        .login-hint {
            font-size: 11px;
            color: var(--muted);
            margin-top: 16px
        }

        .login-hint code {
            background: rgba(244, 63, 94, .1);
            color: var(--rose);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px
        }

        /* Dashboard (hidden by default) */
        .dashboard {
            display: none;
            padding: 24px 32px;
            position: relative;
            z-index: 1
        }

        /* Profile card */
        .profile-card {
            background: var(--card);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 24px;
            position: relative;
            overflow: hidden
        }

        .profile-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #f43f5e, #f59e0b)
        }

        .avatar {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 800;
            color: #fff;
            flex-shrink: 0
        }

        .avatar.male {
            background: linear-gradient(135deg, #6366f1, #8b5cf6)
        }

        .avatar.female {
            background: linear-gradient(135deg, #ec4899, #f43f5e)
        }

        .profile-info h3 {
            font-size: 22px;
            font-weight: 700;
            letter-spacing: -.3px
        }

        .profile-meta {
            display: flex;
            gap: 20px;
            margin-top: 8px;
            flex-wrap: wrap
        }

        .profile-meta span {
            font-size: 12px;
            color: var(--sub);
            display: flex;
            align-items: center;
            gap: 5px
        }

        .profile-meta .label {
            color: var(--muted);
            font-weight: 600
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(244, 63, 94, .1);
            border: 1px solid rgba(244, 63, 94, .2);
            color: var(--rose);
            padding: 7px 16px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            transition: all .2s
        }

        .logout-btn:hover {
            background: var(--rose);
            color: #fff
        }

        /* KPI mini cards */
        .kpi-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 14px;
            margin-bottom: 24px
        }

        .kpi {
            background: var(--card);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 18px;
            text-align: center;
            transition: all .3s
        }

        .kpi:hover {
            border-color: var(--glow);
            transform: translateY(-2px)
        }

        .kpi-val {
            font-size: 28px;
            font-weight: 800;
            letter-spacing: -1px
        }

        .kpi:nth-child(1) .kpi-val {
            color: var(--rose)
        }

        .kpi:nth-child(2) .kpi-val {
            color: var(--cyan)
        }

        .kpi:nth-child(3) .kpi-val {
            color: var(--emerald)
        }

        .kpi:nth-child(4) .kpi-val {
            color: var(--violet)
        }

        .kpi-lbl {
            font-size: 11px;
            color: var(--muted);
            margin-top: 4px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600
        }

        /* Charts row */
        .chart-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px
        }

        .chart-box {
            background: var(--card);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 22px;
            transition: all .3s
        }

        .chart-box:hover {
            border-color: var(--glow)
        }

        .chart-box h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px
        }

        .chart-box .ch-sub {
            font-size: 11px;
            color: var(--muted);
            margin-bottom: 14px
        }

        .ch-wrap {
            position: relative;
            height: 220px
        }

        /* Timeline */
        .timeline-section {
            background: var(--card);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 22px;
            margin-bottom: 24px
        }

        .timeline-section h4 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px
        }

        .timeline-section .ch-sub {
            font-size: 11px;
            color: var(--muted);
            margin-bottom: 16px
        }

        .timeline {
            max-height: 600px;
            overflow-y: auto;
            padding-right: 8px
        }

        .visit-card {
            border: 1px solid rgba(99, 102, 241, .1);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 12px;
            background: rgba(30, 41, 59, .3);
            transition: all .2s
        }

        .visit-card:hover {
            border-color: rgba(99, 102, 241, .25);
            background: rgba(30, 41, 59, .5)
        }

        .visit-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 8px
        }

        .visit-date {
            font-size: 13px;
            font-weight: 600;
            color: var(--text)
        }

        .visit-badge {
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: .5px
        }

        .visit-badge.emergency {
            background: rgba(244, 63, 94, .15);
            color: var(--rose)
        }

        .visit-badge.consultation {
            background: rgba(99, 102, 241, .15);
            color: var(--blue)
        }

        .visit-badge.diagnostic {
            background: rgba(34, 211, 238, .15);
            color: var(--cyan)
        }

        .visit-reason {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px
        }

        .visit-doctor {
            font-size: 12px;
            color: var(--sub)
        }

        .visit-doctor strong {
            color: var(--text);
            font-weight: 600
        }

        .lab-reports {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(99, 102, 241, .08)
        }

        .lab-reports h5 {
            font-size: 11px;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            margin-bottom: 8px
        }

        .lab-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 10px;
            border-radius: 6px;
            margin-bottom: 4px;
            background: rgba(17, 24, 39, .5);
            font-size: 12px
        }

        .lab-item .test {
            font-weight: 500;
            color: var(--sub)
        }

        .lab-result {
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 700
        }

        .lab-result.normal {
            background: rgba(16, 185, 129, .12);
            color: var(--emerald)
        }

        .lab-result.abnormal {
            background: rgba(244, 63, 94, .12);
            color: var(--rose)
        }

        .lab-result.other {
            background: rgba(245, 158, 11, .12);
            color: var(--amber)
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 5px
        }

        ::-webkit-scrollbar-track {
            background: transparent
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(244, 63, 94, .3);
            border-radius: 3px
        }

        @media(max-width:900px) {
            .kpi-row {
                grid-template-columns: repeat(2, 1fr)
            }

            .chart-row {
                grid-template-columns: 1fr
            }

            .profile-card {
                flex-direction: column;
                text-align: center
            }

            .profile-meta {
                justify-content: center
            }
        }
    </style>
</head>

<body>
    <div class="topbar">
        <div class="topbar-left">
            <a href="index.html">&larr; Back</a>
            <h2>Patient Portal</h2>
        </div>
        <div class="topbar-badge">&#9823; Patient View</div>
    </div>

    <!-- Login screen -->
    <div class="login-screen" id="loginScreen">
        <h2>Welcome, Patient</h2>
        <p>Enter your Patient ID to access your health records</p>
        <div class="login-box">
            <label for="patientIdInput">Patient ID</label>
            <input type="text" class="login-input" id="patientIdInput" placeholder="e.g. P100001" autofocus>
            <button class="login-btn" onclick="loginPatient()">View My Records</button>
            <div class="login-error" id="loginError">Patient ID not found. Please try again.</div>
            <p class="login-hint">Try IDs from <code>P100001</code> to <code>P110000</code></p>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
        <div class="profile-card" id="profileCard"></div>
        <div class="kpi-row" id="kpiRow"></div>
        <div class="chart-row">
            <div class="chart-box">
                <h4>Visit Types</h4>
                <div class="ch-sub">Your visits by type</div>
                <div class="ch-wrap"><canvas id="vtChart"></canvas></div>
            </div>
            <div class="chart-box">
                <h4>Visit Reasons</h4>
                <div class="ch-sub">Why you visited</div>
                <div class="ch-wrap"><canvas id="vrChart"></canvas></div>
            </div>
        </div>
        <div class="timeline-section">
            <h4>Visit Timeline</h4>
            <div class="ch-sub">Your complete visit history with doctors and lab reports</div>
            <div class="timeline" id="timeline"></div>
        </div>
    </div>

    <script>
        let allData = null;
        Chart.defaults.color = '#94a3b8'; Chart.defaults.borderColor = 'rgba(244,63,94,0.06)'; Chart.defaults.font.family = "'Inter',sans-serif";
        const C = ['rgba(244,63,94,.7)', 'rgba(99,102,241,.7)', 'rgba(34,211,238,.7)', 'rgba(245,158,11,.7)', 'rgba(139,92,246,.7)', 'rgba(16,185,129,.7)'];
        const CB = ['#f43f5e', '#6366f1', '#22d3ee', '#f59e0b', '#8b5cf6', '#10b981'];

        document.getElementById('patientIdInput').addEventListener('keydown', e => { if (e.key === 'Enter') loginPatient() });

        async function loadData() {
            if (!allData) { const r = await fetch('patient_records.json'); allData = await r.json() }
            return allData;
        }

        async function loginPatient() {
            const pid = document.getElementById('patientIdInput').value.trim().toUpperCase();
            if (!pid) return;
            const err = document.getElementById('loginError');
            err.style.display = 'none';
            try {
                const data = await loadData();
                const p = data.records[pid];
                if (!p) { err.style.display = 'block'; return }
                renderDashboard(p);
            } catch (e) { err.textContent = 'Failed to load data.'; err.style.display = 'block'; console.error(e) }
        }

        function renderDashboard(p) {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';

            // Profile
            const initials = p.name.split(' ').map(w => w[0]).join('').substring(0, 2);
            document.getElementById('profileCard').innerHTML = `
            <div class="avatar ${p.gender === 'M' ? 'male' : 'female'}">${initials}</div>
            <div class="profile-info">
                <h3>${p.name}</h3>
                <div class="profile-meta">
                    <span><span class="label">ID:</span> ${p.patient_id}</span>
                    <span><span class="label">Gender:</span> ${p.gender === 'M' ? 'Male' : 'Female'}</span>
                    <span><span class="label">DOB:</span> ${p.dob}</span>
                    <span><span class="label">Blood:</span> ${p.blood_group}</span>
                    <span><span class="label">City:</span> ${p.city}</span>
                </div>
            </div>
            <button class="logout-btn" onclick="logout()">Logout</button>`;

            // KPIs
            const s = p.summary;
            document.getElementById('kpiRow').innerHTML = [
                { v: s.total_visits, l: 'Total Visits' },
                { v: s.total_lab_reports, l: 'Lab Reports' },
                { v: s.doctors_seen.length, l: 'Doctors Seen' },
                { v: s.hospitals_visited.length, l: 'Hospitals' }
            ].map(k => `<div class="kpi"><div class="kpi-val">${k.v}</div><div class="kpi-lbl">${k.l}</div></div>`).join('');

            // Charts
            renderChart('vtChart', 'doughnut', Object.keys(s.visit_types), Object.values(s.visit_types));
            renderChart('vrChart', 'bar', Object.keys(s.reasons), Object.values(s.reasons), true);

            // Timeline
            const tl = document.getElementById('timeline');
            tl.innerHTML = p.visits.map(v => {
                const bc = v.visit_type.toLowerCase();
                let labs = '';
                if (v.lab_reports.length > 0) {
                    labs = `<div class="lab-reports"><h5>Lab Reports</h5>${v.lab_reports.map(l => {
                        const rc = l.result.toLowerCase().includes('normal') && !l.result.toLowerCase().includes('abnormal') ? 'normal' : l.result.toLowerCase().includes('abnormal') ? 'abnormal' : 'other';
                        return `<div class="lab-item"><span class="test">${l.test_type}</span><span class="lab-result ${rc}">${l.result}</span></div>`;
                    }).join('')}</div>`;
                }
                return `<div class="visit-card">
                <div class="visit-top">
                    <div class="visit-date">${v.visit_date}</div>
                    <span class="visit-badge ${bc}">${v.visit_type}</span>
                </div>
                <div class="visit-reason">${v.reason}</div>
                <div class="visit-doctor">Dr. <strong>${v.doctor.name}</strong> &mdash; ${v.doctor.specialization}, ${v.doctor.hospital}</div>
                ${labs}
            </div>`;
            }).join('');
        }

        function renderChart(id, type, labels, data, horiz) {
            const canvas = document.getElementById(id);
            if (canvas._chart) canvas._chart.destroy();
            const opts = { responsive: true, maintainAspectRatio: false, animation: { duration: 600 }, plugins: { legend: { position: type === 'doughnut' ? 'right' : 'top', labels: { font: { size: 11 }, padding: 10 } }, tooltip: { backgroundColor: 'rgba(17,24,39,.95)', borderColor: 'rgba(244,63,94,.3)', borderWidth: 1, cornerRadius: 8, padding: 10 } } };
            if (type === 'bar') { opts.indexAxis = horiz ? 'y' : 'x'; opts.scales = { x: { beginAtZero: true, grid: { color: 'rgba(244,63,94,.05)' } }, y: { grid: { display: false } } } }
            if (type === 'doughnut') opts.cutout = '60%';
            canvas._chart = new Chart(canvas.getContext('2d'), { type, data: { labels, datasets: [{ data, backgroundColor: C.slice(0, data.length), borderColor: CB.slice(0, data.length), borderWidth: 1, borderRadius: type === 'bar' ? 6 : 0 }] }, options: opts });
        }

        function logout() {
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('patientIdInput').value = '';
        }
    </script>
</body>

</html>